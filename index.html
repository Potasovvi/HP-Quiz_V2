<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrazione</title>
    <link rel="stylesheet" href="style1.css"> 
</head>
<body>
  <div class="form-container">
    <h1>Sei pronto a ottenere il tuo G.U.F.O. ? Registrati!</h1>
    <form id="registrationForm">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required><br><br>
        <label for="cognome">Cognome:</label>
        <input type="text" id="cognome" name="cognome" required><br><br>
        <button type="submit">Salva</button>
    </form>
</div>

<script type="module">
  // Importa le funzioni necessarie da Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Configurazione di Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBLwqp44jIZJ-gjonGI3Hbl_lAGe9N4t_Q",
    authDomain: "hp-quiz-4657.firebaseapp.com",
    projectId: "hp-quiz-4657",
    storageBucket: "hp-quiz-4657.appspot.com",
    messagingSenderId: "66690107707",
    appId: "1:66690107707:web:0f3fe455c037f2bab28f1e"
  };

  // Inizializza Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Aggiungi un partecipante
  document.getElementById('registrationForm').addEventListener('submit', async function(event) {
    event.preventDefault();

    const nome = document.getElementById('nome').value;
    const cognome = document.getElementById('cognome').value;

    // Verifica se l'utente esiste già
    const q = query(collection(db, 'Partecipanti'), where('nome', '==', nome), where('cognome', '==', cognome));
    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      alert('Utente già registrato!');
      return;
    }

    // Aggiungi un nuovo partecipante
    try {
      await addDoc(collection(db, 'Partecipanti'), {
        nome: nome,
        cognome: cognome,
        punteggio: 0
      });
      window.location.href = `quiz-hp.html?nome=${encodeURIComponent(nome)}&cognome=${encodeURIComponent(cognome)}`;
    } catch (e) {
      console.error('Errore aggiungendo il partecipante:', e);
    }
  });
</script>

</body>
</html>
