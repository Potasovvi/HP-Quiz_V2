<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
</head>
<body>
    <h1>Quiz</h1>
    <form id="quizForm">
        <p>Domanda 1: Qual è il nome del negozio di dolciumi a Diagon Alley dove vendono le caramelle esplosive?</p>
        <input type="radio" id="q1a" name="q1" value="A" required>
        <label for="q1a">Zuccherificio Honore</label><br>
        <input type="radio" id="q1b" name="q1" value="B">
        <label for="q1b">Bottega del dolce</label><br>
        <input type="radio" id="q1c" name="q1" value="C">
        <label for="q1c">Ladroga</label><br>

        <p>Domanda 2: Quale incantesimo ha usato Hermione per liberare Ron dalla morsa di un troll nella sua prima avventura a Hogwarts?</p>
        <input type="radio" id="q2a" name="q2" value="A" required>
        <label for="q2a">Wingardium Leviosa</label><br>
        <input type="radio" id="q2b" name="q2" value="B">
        <label for="q2b">Lumos</label><br>
        <input type="radio" id="q2c" name="q2" value="C">
        <label for="q2c">Stupefy</label><br>

        <p>Domanda 3: Chi ha lasciato a Harry la Mappa del Malandrino nel suo primo anno a Hogwarts?</p>
        <input type="radio" id="q3a" name="q3" value="A" required>
        <label for="q3a">Remus Lupin</label><br>
        <input type="radio" id="q3b" name="q3" value="B">
        <label for="q3b">I gemelli Weasley</label><br>
        <input type="radio" id="q3c" name="q3" value="C">
        <label for="q3c">Albus Silente</label><br>

        <p>Domanda 4: In quale luogo si è tenuto il Ballo del Ceppo durante il Torneo Tremagico?</p>
        <input type="radio" id="q4a" name="q4" value="A" required>
        <label for="q4a">La Sala Grande</label><br>
        <input type="radio" id="q4b" name="q4" value="B">
        <label for="q4b">La Foresta Proibita</label><br>
        <input type="radio" id="q4c" name="q4" value="C">
        <label for="q4c">La Sala Comune di Grifondoro</label><br>

        <p>Domanda 5: Qual è il nome del torneo di Quidditch tra le scuole di magia britanniche?</p>
        <input type="radio" id="q5a" name="q5" value="A" required>
        <label for="q5a">Coppa delle Quattro Scuole</label><br>
        <input type="radio" id="q5b" name="q5" value="B">
        <label for="q5b">Torneo Tremagico</label><br>
        <input type="radio" id="q5c" name="q5" value="C">
        <label for="q5c">Coppa di Quidditch</label><br>

        <p>Domanda 6: Chi ha creato gli Horcrux?</p>
        <input type="radio" id="q6a" name="q6" value="A" required>
        <label for="q6a">Albus Silente</label><br>
        <input type="radio" id="q6b" name="q6" value="B">
        <label for="q6b">Lord Voldemort</label><br>
        <input type="radio" id="q6c" name="q6" value="C">
        <label for="q6c">Bellatrix Lestrange</label><br>

        <p>Domanda 7: Quale creatura magica ha attaccato Ron Weasley durante il viaggio sul treno per Hogwarts nel secondo libro?</p>
        <input type="radio" id="q7a" name="q7" value="A" required>
        <label for="q7a">Un goblin</label><br>
        <input type="radio" id="q7b" name="q7" value="B">
        <label for="q7b">Un compagno</label><br>
        <input type="radio" id="q7c" name="q7" value="C">
        <label for="q7c">Un ragno gigante</label><br>

        <p>Domanda 8: In quale luogo si è svolto il duello finale tra Harry Potter e Lord Voldemort?</p>
        <input type="radio" id="q8a" name="q8" value="A" required>
        <label for="q8a">La Sala Grande</label><br>
        <input type="radio" id="q8b" name="q8" value="B">
        <label for="q8b">La Foresta Proibita</label><br>
        <input type="radio" id="q8c" name="q8" value="C">
        <label for="q8c">Il Dipartimento dei Misteri</label><br>

        <p>Domanda 9: Qual è il nome della bacchetta magica di Harry Potter?</p>
        <input type="radio" id="q9a" name="q9" value="A" required>
        <label for="q9a">Bacchetta di Sambuco</label><br>
        <input type="radio" id="q9b" name="q9" value="B">
        <label for="q9b">Bacchetta di Pessegus</label><br>
        <input type="radio" id="q9c" name="q9" value="C">
        <label for="q9c">Bacchetta di Alloro, pelo di fenice, 11 pollici</label><br>

        <p>Domanda 10: Chi ha insegnato a Harry Potter l'incantesimo Patronus?</p>
        <input type="radio" id="q10a" name="q10" value="A" required>
        <label for="q10a">Remus Lupin</label><br>
        <input type="radio" id="q10b" name="q10" value="B">
        <label for="q10b">Severus Piton</label><br>
        <input type="radio" id="q10c" name="q10" value="C">
        <label for="q10c">Albus Silente</label><br>

        <button type="submit">Invia</button>
    </form>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const nome = urlParams.get('nome');
        const cognome = urlParams.get('cognome');

        const request = indexedDB.open('PartecipantiDB', 1);
        let db;

        request.onsuccess = function(event) {
            db = event.target.result;
        };

        request.onerror = function(event) {
            console.error('Database error:', event.target.errorCode);
        };

        document.getElementById('quizForm').addEventListener('submit', function(event) {
            event.preventDefault();

            let punteggio = 0;

            if (document.querySelector('input[name="q1"]:checked').value === 'A') punteggio += 1;
            if (document.querySelector('input[name="q2"]:checked').value === 'C') punteggio += 1;
            if (document.querySelector('input[name="q3"]:checked').value === 'B') punteggio += 1;
            if (document.querySelector('input[name="q4"]:checked').value === 'A') punteggio += 1;
            if (document.querySelector('input[name="q6"]:checked').value === 'B') punteggio += 1;
            if (document.querySelector('input[name="q7"]:checked').value === 'C') punteggio += 1;
            if (document.querySelector('input[name="q8"]:checked').value === 'B') punteggio += 1;
            if (document.querySelector('input[name="q9"]:checked').value === 'C') punteggio += 1;
            if (document.querySelector('input[name="q10"]:checked').value === 'A') punteggio += 1;

            const transaction = db.transaction(['Partecipanti'], 'readwrite');
            const objectStore = transaction.objectStore('Partecipanti');
            const index = objectStore.index('nome');

            index.openCursor().onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor) {
                    if (cursor.value.nome === nome && cursor.value.cognome === cognome) {
                        const updateData = cursor.value;
                        updateData.punteggio = punteggio;
                        const requestUpdate = cursor.update(updateData);

                        requestUpdate.onsuccess = function() {
                            alert(`Quiz completato! Il tuo punteggio è ${punteggio}.`);
                        };

                        requestUpdate.onerror = function(event) {
                            console.error('Update error:', event.target.errorCode);
                        };

                        return;
                    }
                    cursor.continue();
                }
            };
        });
    </script>
</body>
</html>
